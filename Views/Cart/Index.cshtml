@model IEnumerable<BookStoreMVC.Models.CartItem>
@{
    ViewData["Title"] = "Your Cart";
    // compute total for display; handle potential null model or null book
    decimal total = Model?.Sum(i => (i.Book?.Price ?? 0M) * i.Quantity) ?? 0M;
}

<h2 class="mb-3">Your Cart</h2>

@if (Model == null || !Model.Any())
{
    <div class="alert alert-info">Your cart is empty.</div>
    <div class="mt-3">
        <a class="btn btn-primary" asp-controller="Books" asp-action="Index"><i class="bi bi-book me-1"></i> Explore Books</a>
    </div>
}
else
{
    <div class="card product-card p-2 p-md-3">
        <div class="table-responsive">
            <table class="table align-middle mb-0">
                <thead class="table-light">
                    <tr>
                        <th>Item</th>
                        <th class="text-center">Qty</th>
                        <th class="text-end">Price</th>
                        <th class="text-end">Subtotal</th>
                        <th></th>
                    </tr>
                </thead>
                <tbody>
                @foreach (var i in Model)
                {
                    <tr>
                        <td>
                            <div class="d-flex align-items-center gap-3">
                                <img class="cart-thumb" src="@(string.IsNullOrWhiteSpace(i.Book?.ImageUrl) ? Url.Content("~/images/default-book.png") : i.Book!.ImageUrl)" alt="@i.Book?.Title" />
                                <div>
                                    <div class="fw-semibold">@i.Book.Title</div>
                                    <small class="text-muted">@i.Book.Category?.Name</small>
                                </div>
                            </div>
                        </td>
                        <td class="text-center">
                            <div class="input-group input-group-sm qty-input mx-auto">
                                <a class="btn btn-outline-secondary" asp-action="Update" asp-route-id="@i.Id" asp-route-qty="@(i.Quantity - 1)">-</a>
                                <input class="form-control text-center" value="@i.Quantity" readonly />
                                <a class="btn btn-outline-secondary" asp-action="Update" asp-route-id="@i.Id" asp-route-qty="@(i.Quantity + 1)">+</a>
                            </div>
                        </td>
                        <td class="text-end">₹@($"{(i.Book?.Price ?? 0M):0.00}")</td>
                        <td class="text-end">₹@($"{((i.Book?.Price ?? 0M) * i.Quantity):0.00}")</td>
                        <td class="text-end">
                            <a class="btn btn-outline-danger btn-sm btn-rounded" asp-action="Remove" asp-route-id="@i.Id">
                                <i class="bi bi-trash"></i>
                            </a>
                        </td>
                    </tr>
                }
                </tbody>
            </table>
        </div>
        <div class="mt-3 d-flex flex-column flex-md-row justify-content-between gap-2">
            <a class="btn btn-outline-secondary" asp-controller="Books" asp-action="Index"><i class="bi bi-arrow-left me-1"></i> Continue Shopping</a>
            <div class="ms-md-auto">
                <div class="h5 mb-2">Total: <span class="fw-bold">₹@($"{total:0.00}")</span></div>
                <a class="btn btn-primary" asp-controller="Cart" asp-action="Checkout"><i class="bi bi-bag-check me-1"></i> Proceed to Checkout</a>
            </div>
        </div>
    </div>
}